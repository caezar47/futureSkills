!function(e,i){"function"==typeof define&&define.amd?define(["jquery"],function(t){return i(e,t)}):"object"==typeof exports?i(e,require("jquery")):i(e,e.jQuery)}("undefined"!=typeof window?window:this,function(t,y){"use strict";var _=t.document,o="__pz__",a=Array.prototype.slice,e=/trident\/7./i,d=function(){if(e.test(navigator.userAgent))return!1;var t=_.createElement("input");return t.setAttribute("oninput","return"),"function"==typeof t.oninput}(),r=/([A-Z])/g,h=/^http:[\w\.\/]+svg$/,i="(\\-?\\d[\\d\\.e-]*)",n="\\,?\\s*",s=new RegExp("^matrix\\("+i+n+i+n+i+n+i+n+i+n+i+"\\)$");function c(t){var e={range:!0,animate:!0};return"boolean"==typeof t?e.animate=t:y.extend(e,t),e}function v(t,e,i,n,s,a,o,r,h){"array"===y.type(t)?this.elements=[+t[0],+t[2],+t[4],+t[1],+t[3],+t[5],0,0,1]:this.elements=[t,e,i,n,s,a,o||0,r||0,h||1]}function g(t,e,i){this.elements=[t,e,i]}function m(t,i){if(!(this instanceof m))return new m(t,i);1!==t.nodeType&&y.error("Panzoom called on non-Element node"),y.contains(_,t)||y.error("Panzoom element must be attached to the document");var e=y.data(t,o);if(e)return e;this.options=i=y.extend({},m.defaults,i),this.elem=t;var n=this.$elem=y(t);this.$set=i.$set&&i.$set.length?i.$set:n,this.$doc=y(t.ownerDocument||_),this.$parent=n.parent(),this.parent=this.$parent[0],this.isSVG=h.test(t.namespaceURI)&&"svg"!==t.nodeName.toLowerCase(),this.panning=!1,this._buildTransform(),this._transform=y.cssProps.transform.replace(r,"-$1").toLowerCase(),this._buildTransition(),this.resetDimensions();var s=y(),a=this;y.each(["$zoomIn","$zoomOut","$zoomRange","$reset"],function(t,e){a[e]=i[e]||s}),this.enable(),this.scale=this.getMatrix()[0],this._checkPanWhenZoomed(),y.data(t,o,this)}return v.prototype={x:function(t){var e=t instanceof g,i=this.elements,n=t.elements;return e&&3===n.length?new g(i[0]*n[0]+i[1]*n[1]+i[2]*n[2],i[3]*n[0]+i[4]*n[1]+i[5]*n[2],i[6]*n[0]+i[7]*n[1]+i[8]*n[2]):n.length===i.length&&new v(i[0]*n[0]+i[1]*n[3]+i[2]*n[6],i[0]*n[1]+i[1]*n[4]+i[2]*n[7],i[0]*n[2]+i[1]*n[5]+i[2]*n[8],i[3]*n[0]+i[4]*n[3]+i[5]*n[6],i[3]*n[1]+i[4]*n[4]+i[5]*n[7],i[3]*n[2]+i[4]*n[5]+i[5]*n[8],i[6]*n[0]+i[7]*n[3]+i[8]*n[6],i[6]*n[1]+i[7]*n[4]+i[8]*n[7],i[6]*n[2]+i[7]*n[5]+i[8]*n[8])},inverse:function(){var t=1/this.determinant(),e=this.elements;return new v(t*(e[8]*e[4]-e[7]*e[5]),t*-(e[8]*e[1]-e[7]*e[2]),t*(e[5]*e[1]-e[4]*e[2]),t*-(e[8]*e[3]-e[6]*e[5]),t*(e[8]*e[0]-e[6]*e[2]),t*-(e[5]*e[0]-e[3]*e[2]),t*(e[7]*e[3]-e[6]*e[4]),t*-(e[7]*e[0]-e[6]*e[1]),t*(e[4]*e[0]-e[3]*e[1]))},determinant:function(){var t=this.elements;return t[0]*(t[8]*t[4]-t[7]*t[5])-t[3]*(t[8]*t[1]-t[7]*t[2])+t[6]*(t[5]*t[1]-t[4]*t[2])}},g.prototype.e=v.prototype.e=function(t){return this.elements[t]},m.rmatrix=s,m.defaults={eventNamespace:".panzoom",transition:!0,cursor:"move",disablePan:!1,disableZoom:!1,disableXAxis:!1,disableYAxis:!1,which:1,increment:.3,linearZoom:!1,panOnlyWhenZoomed:!1,minScale:.3,maxScale:6,rangeStep:.05,duration:200,easing:"ease-in-out",contain:!1},m.prototype={constructor:m,instance:function(){return this},enable:function(){this._initStyle(),this._bind(),this.disabled=!1},disable:function(){this.disabled=!0,this._resetStyle(),this._unbind()},isDisabled:function(){return this.disabled},destroy:function(){this.disable(),y.removeData(this.elem,o)},resetDimensions:function(){this.container=this.parent.getBoundingClientRect();var t=this.elem,e=t.getBoundingClientRect(),i=Math.abs(this.scale);this.dimensions={width:e.width,height:e.height,left:y.css(t,"left",!0)||0,top:y.css(t,"top",!0)||0,border:{top:y.css(t,"borderTopWidth",!0)*i||0,bottom:y.css(t,"borderBottomWidth",!0)*i||0,left:y.css(t,"borderLeftWidth",!0)*i||0,right:y.css(t,"borderRightWidth",!0)*i||0},margin:{top:y.css(t,"marginTop",!0)*i||0,left:y.css(t,"marginLeft",!0)*i||0}}},reset:function(t){t=c(t);var e=this.setMatrix(this._origTransform,t);t.silent||this._trigger("reset",e)},resetZoom:function(t){t=c(t);var e=this.getMatrix(this._origTransform);t.dValue=e[3],this.zoom(e[0],t)},resetPan:function(t){var e=this.getMatrix(this._origTransform);this.pan(e[4],e[5],c(t))},setTransform:function(t){for(var e=this.$set,i=e.length;i--;)y.style(e[i],"transform",t),this.isSVG&&e[i].setAttribute("transform",t)},getTransform:function(t){var e=this.$set[0];return t?this.setTransform(t):(t=y.style(e,"transform"),!this.isSVG||t&&"none"!==t||(t=y.attr(e,"transform")||"none")),"none"===t||s.test(t)||this.setTransform(t=y.css(e,"transform")),t||"none"},getMatrix:function(t){var e=s.exec(t||this.getTransform());return e&&e.shift(),e||[1,0,0,1,0,0]},getScale:function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2))},setMatrix:function(t,e){if(!this.disabled){e||(e={}),"string"==typeof t&&(t=this.getMatrix(t));var i=this.getScale(t),n=void 0!==e.contain?e.contain:this.options.contain;if(n){var s,a,o,r=e.dims;r||(this.resetDimensions(),r=this.dimensions);var h=this.container,c=r.width,l=r.height,d=h.width,m=h.height,u=d/c,f=m/l;"center"!==this.$parent.css("textAlign")||"inline"!==y.css(this.elem,"display")?(s=(o=(c-this.elem.offsetWidth)/2)-r.border.left,a=c-d-o+r.border.right):s=a=(c-d)/2;var p=(l-m)/2+r.border.top,v=(l-m)/2-r.border.top-r.border.bottom;t[4]="invert"===n||"automatic"===n&&u<1.01?Math.max(Math.min(t[4],s-r.border.left),-a):Math.min(Math.max(t[4],s),-a),t[5]="invert"===n||"automatic"===n&&f<1.01?Math.max(Math.min(t[5],p-r.border.top),-v):Math.min(Math.max(t[5],p),-v)}if("skip"!==e.animate&&this.transition(!e.animate),e.range&&this.$zoomRange.val(i),this.options.disableXAxis||this.options.disableYAxis){var g=this.getMatrix();this.options.disableXAxis&&(t[4]=g[4]),this.options.disableYAxis&&(t[5]=g[5])}return this.setTransform("matrix("+t.join(",")+")"),this.scale=i,this._checkPanWhenZoomed(i),e.silent||this._trigger("change",t),t}},isPanning:function(){return this.panning},transition:function(t){if(this._transition)for(var e=t||!this.options.transition?"none":this._transition,i=this.$set,n=i.length;n--;)y.style(i[n],"transition")!==e&&y.style(i[n],"transition",e)},pan:function(t,e,i){if(!this.options.disablePan){i||(i={});var n=i.matrix;n||(n=this.getMatrix()),i.relative&&(t+=+n[4],e+=+n[5]),n[4]=t,n[5]=e,this.setMatrix(n,i),i.silent||this._trigger("pan",n[4],n[5])}},zoom:function(t,e){"object"==typeof t?(e=t,t=null):e||(e={});var i=y.extend({},this.options,e);if(!i.disableZoom){var n=!1,s=i.matrix||this.getMatrix(),a=new v(s),o=this.getScale(s);"number"!=typeof t?(t=i.linearZoom?1+i.increment*(t?-1:1)/o:t?1/(1+i.increment):1+i.increment,n=!0):t=1/o,t=Math.max(Math.min(t,i.maxScale/o),i.minScale/o);var r=a.x(new v(t,0,0,0,"number"==typeof i.dValue?i.dValue/o:t,0)),h=i.focal;if(h&&!i.disablePan){this.resetDimensions();var c=i.dims=this.dimensions,l=h.clientX,d=h.clientY;this.isSVG||(l-=c.width/o/2,d-=c.height/o/2);var m=new g(l,d,1),u=this.parentOffset||this.$parent.offset(),f=new v(1,0,u.left-this.$doc.scrollLeft(),0,1,u.top-this.$doc.scrollTop()),p=a.inverse().x(f.inverse().x(m));a=a.x(new v([t,0,0,t,0,0])),m=f.x(a.x(p)),s[4]=+s[4]+(l-m.e(0)),s[5]=+s[5]+(d-m.e(1))}s[0]=r.e(0),s[1]=r.e(3),s[2]=r.e(1),s[3]=r.e(4),this.setMatrix(s,{animate:void 0!==i.animate?i.animate:n,range:!i.noSetRange}),i.silent||this._trigger("zoom",t,i)}},option:function(t,e){var i;if(!t)return y.extend({},this.options);if("string"==typeof t){if(1===arguments.length)return void 0!==this.options[t]?this.options[t]:null;(i={})[t]=e}else i=t;this._setOptions(i)},_setOptions:function(t){y.each(t,y.proxy(function(t,e){switch(t){case"disablePan":this._resetStyle();case"$zoomIn":case"$zoomOut":case"$zoomRange":case"$reset":case"disableZoom":case"onStart":case"onChange":case"onZoom":case"onPan":case"onEnd":case"onReset":case"eventNamespace":this._unbind()}switch(this.options[t]=e,t){case"disablePan":this._initStyle();case"$zoomIn":case"$zoomOut":case"$zoomRange":case"$reset":this[t]=e;case"disableZoom":case"onStart":case"onChange":case"onZoom":case"onPan":case"onEnd":case"onReset":case"eventNamespace":this._bind();break;case"cursor":y.style(this.elem,"cursor",e);break;case"minScale":this.$zoomRange.attr("min",e);break;case"maxScale":this.$zoomRange.attr("max",e);break;case"rangeStep":this.$zoomRange.attr("step",e);break;case"startTransform":this._buildTransform();break;case"duration":case"easing":this._buildTransition();case"transition":this.transition();break;case"panOnlyWhenZoomed":this._checkPanWhenZoomed();break;case"$set":e instanceof y&&e.length&&(this.$set=e,this._initStyle(),this._buildTransform())}},this))},_checkPanWhenZoomed:function(t){var e=this.options;if(e.panOnlyWhenZoomed){t||(t=this.getMatrix()[0]);var i=t<=e.minScale;e.disablePan!==i&&this.option("disablePan",i)}},_initStyle:function(){var t={"transform-origin":this.isSVG?"0 0":"50% 50%"};this.options.disablePan||(t.cursor=this.options.cursor),this.$set.css(t);var e=this.$parent;e.length&&!y.nodeName(this.parent,"body")&&(t={overflow:"hidden"},"static"===e.css("position")&&(t.position="relative"),e.css(t))},_resetStyle:function(){this.$elem.css({cursor:"",transition:""}),this.$parent.css({overflow:"",position:""})},_bind:function(){var i=this,n=this.options,e=n.eventNamespace,t="mousedown"+e+" pointerdown"+e+" MSPointerDown"+e,s="touchstart"+e+" "+t,a="touchend"+e+" click"+e+" pointerup"+e+" MSPointerUp"+e,o={},r=this.$reset,h=this.$zoomRange;if(y.each(["Start","Change","Zoom","Pan","End","Reset"],function(){var t=n["on"+this];y.isFunction(t)&&(o["panzoom"+this.toLowerCase()+e]=t)}),n.disablePan&&n.disableZoom||(o[s]=function(t){var e;("touchstart"===t.type?!(e=t.touches||t.originalEvent.touches)||(1!==e.length||n.disablePan)&&2!==e.length:n.disablePan||(t.which||t.originalEvent.which)!==n.which)||(t.preventDefault(),t.stopPropagation(),i._startMove(t,e))},3===n.which&&(o.contextmenu=!1)),this.$elem.on(o),r.length&&r.on(a,function(t){t.preventDefault(),i.reset()}),h.length&&h.attr({step:n.rangeStep===m.defaults.rangeStep&&h.attr("step")||n.rangeStep,min:n.minScale,max:n.maxScale}).prop({value:this.getMatrix()[0]}),!n.disableZoom){var c=this.$zoomIn,l=this.$zoomOut;c.length&&l.length&&(c.on(a,function(t){t.preventDefault(),i.zoom()}),l.on(a,function(t){t.preventDefault(),i.zoom(!0)})),h.length&&((o={})[t]=function(){i.transition(!0)},o[(d?"input":"change")+e]=function(){i.zoom(+this.value,{noSetRange:!0})},h.on(o))}},_unbind:function(){this.$elem.add(this.$zoomIn).add(this.$zoomOut).add(this.$reset).off(this.options.eventNamespace)},_buildTransform:function(){return this._origTransform=this.getTransform(this.options.startTransform)},_buildTransition:function(){if(this._transform){var t=this.options;this._transition=this._transform+" "+t.duration+"ms "+t.easing}},_getDistance:function(t){var e=t[0],i=t[1];return Math.sqrt(Math.pow(Math.abs(i.clientX-e.clientX),2)+Math.pow(Math.abs(i.clientY-e.clientY),2))},_getMiddle:function(t){var e=t[0],i=t[1];return{clientX:(i.clientX-e.clientX)/2+e.clientX,clientY:(i.clientY-e.clientY)/2+e.clientY}},_trigger:function(t){"string"==typeof t&&(t="panzoom"+t),this.$elem.triggerHandler(t,[this].concat(a.call(arguments,1)))},_startMove:function(t,s){if(!this.panning){var e,i,a,o,r,h,c,n,l=this,d=this.options,m=d.eventNamespace,u=this.getMatrix(),f=u.slice(0),p=+f[4],v=+f[5],g={matrix:u,animate:"skip"},b=t.type;i="pointerdown"===b?(e="pointermove","pointerup"):"touchstart"===b?(e="touchmove","touchend"):"MSPointerDown"===b?(e="MSPointerMove","MSPointerUp"):(e="mousemove","mouseup"),e+=m,i+=m,this.transition(!0),this.panning=!0,this._trigger("start",t,s);var x=function(t,e){if(e){if(2===e.length){if(null!=a)return;return a=l._getDistance(e),o=l.getScale(u),void(r=l._getMiddle(e))}if(null!=h)return;(n=e[0])&&(h=n.pageX,c=n.pageY)}null==h&&(h=t.pageX,c=t.pageY)};x(t,s);y(_).off(m).on(e,function(t){var e;if(t.preventDefault(),s=t.touches||t.originalEvent.touches,x(t,s),s){if(2===s.length){var i=l._getMiddle(s),n=l._getDistance(s)-a;return l.zoom(n*(d.increment/100)+o,{focal:i,matrix:u,animate:"skip"}),l.pan(+u[4]+i.clientX-r.clientX,+u[5]+i.clientY-r.clientY,g),void(r=i)}e=s[0]||{pageX:0,pageY:0}}e||(e=t),l.pan(p+e.pageX-h,v+e.pageY-c,g)}).on(i,function(t){t.preventDefault(),y(this).off(m),l.panning=!1,t.type="panzoomend",l._trigger(t,u,!function(t,e){for(var i=t.length;--i;)if(Math.round(+t[i])!==Math.round(+e[i]))return!1;return!0}(u,f))})}}},y.Panzoom=m,y.fn.panzoom=function(t){var e,i,n,s;return"string"==typeof t?(s=[],i=a.call(arguments,1),this.each(function(){(e=y.data(this,o))?"_"!==t.charAt(0)&&"function"==typeof(n=e[t])&&void 0!==(n=n.apply(e,i))&&s.push(n):s.push(void 0)}),s.length?1===s.length?s[0]:s:this):this.each(function(){new m(this,t)})},m}),$(document).ready(function(r){r=$;var t=$('[data-map="svg"]'),i=$('[data-map="zoom-in"]'),n=$('[data-map="zoom-out"]'),s=t.panzoom({minScale:1,maxScale:5,increment:.25,contain:"automatic",panOnlyWhenZoomed:!0,$zoomIn:i,$zoomOut:n});s.parent().on("mousewheel.focal",function(t){t.preventDefault();var e=t.delta||t.originalEvent.wheelDelta,i=e?e<0:0<t.originalEvent.deltaY;s.panzoom("zoom",i,{increment:.1,animate:!1,focal:t})});var a=r("#svg"),h={};r.ajax({type:"GET",url:xmlpath,dataType:"xml",success:function(t){r(t).find("region").each(function(){var t=r(this).attr("id"),e=r(this).find("style"),i=r(this).find("params"),n=r(this).find("prices"),s=r(this).find("extra_row"),a=r(this).find("text"),o=r(this).find("special");h[t]={style:{color:r(e).find("color").text(),border:r(e).find("border").text(),bdw:r(e).find("border_width").text()},params:{area:r(i).find("area").text(),status:r(i).find("status").text()},prices:{sotka:r(n).find("sotka").text()?parseInt(r(n).find("sotka").text(),10):0,land:r(n).find("land").text()?parseInt(r(n).find("land").text(),10):0,arr:r(n).find("arrangement").text()?parseInt(r(n).find("arrangement").text(),10):0},extra_row:{label:r(s).find("label").text(),value:r(s).find("value").text()},text:r(a).text(),special:r(o).text()}})}}),r("path").on("mouseover touchstart",function(){if(r(this).hasClass("active")){var t=r(this).data("id");a.append(r(this)),r(".js-box-default").hide(),r(".js-box-data").show(),r(".js-caption").find(".js-id").text(t),h[t].params.area?r(".js-val-area").find(".js-val").text(h[t].params.area):r(".js-val-area").css("visibility","hidden"),h[t].params.status?r(".js-val-status").css("visibility","visible").find(".js-val").text(h[t].params.status):r(".js-val-status").css("visibility","hidden"),"Продан"==h[t].params.status?r(".js-val-status-btn").css("visibility","hidden"):r(".js-val-status-btn").css("visibility","visible"),h[t].prices.sotka?r(".js-val-sotka").css("visibility","visible").find(".js-val").text(h[t].prices.sotka):r(".js-val-sotka").css("visibility","hidden"),h[t].prices.land?r(".js-val-land").css("visibility","visible").find(".js-val").text(h[t].prices.land):r(".js-val-land").css("visibility","hidden"),h[t].prices.arr?r(".js-val-arr").css("visibility","visible").find(".js-val").text(h[t].prices.arr):r(".js-val-arr").css("visibility","hidden"),h[t].prices.full?r(".js-val-full").css("visibility","visible").find(".js-val").text(h[t].prices.full):r(".js-val-full").css("visibility","hidden"),h[t].text?r(".js-val-text").html(h[t].text).show():r(".js-val-text").hide(),h[t].special?r(".js-val-special").css("visibility","visible").html(h[t].special).show():r(".js-val-special").css("visibility","hidden")}}),r("path").on("mouseout",function(){}),a.on("touchmove",function(){r(e.target).hasClass("active")||(r(".js-box-default").show(),r(".js-box-data").hide())})});